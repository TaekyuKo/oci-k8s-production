---
# Cert-Manager 설치 (자동 TLS 인증서 관리)

- name: Install Cert-Manager
  hosts: k8s_master[0]
  become: yes
  roles:
    - cert-manager
  
  post_tasks:
    - name: Wait for Cert-Manager webhook
      shell: kubectl wait --for=condition=ready pod -l app=webhook -n cert-manager --timeout=300s
      become_user: ubuntu
      changed_when: false
      
    - name: Verify Cert-Manager CRDs
      shell: kubectl get crd certificates.cert-manager.io
      become_user: ubuntu
      register: cert_manager_crd
      changed_when: false
      
    - name: Display Cert-Manager status
      debug:
        msg: "✓ Cert-Manager installed and ready"
